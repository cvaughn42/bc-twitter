<div>

    <div id="tweetContainer" class="tweet-container">

    </div>

    <div class="tweet-console">

        Tweet:&nbsp;<input type="text" maxlength="140">
        <button id="tweetButton" name="tweetButton" value="Tweet">Tweet</button>

    </div>

</div>

 <script>

     var lastRead = new Date(1);
     var currentUser = $('#currentUser').val();

     var getTweets = function() {

        $.ajax('/getTweets', {
            dataType: "json",
            data: {
                "userName": currentUser,
                "lastRead": lastRead
            },
            type: 'POST',
            error: function(jqXhr, status, err) {
                alert("Unable to read tweets: " + err);
            },
            success: function(data) {

                for (var i = data.length - 1; i >= 0; i--)
                {
                    $('#tweetContainer').prepend(
                        "<div class='tweet'>" +
                            "<div class='tweet-date'>" + data[i].date + "</div>" +
                            "<div class='tweet-author'>" + data[i].author.firstName + " " + data[i].author.lastName + " (" + data[i].author.userName + ")</div>" +
                            "<div class='tweet-message'>" + data[i].message + "</div>" + 
                        "</div>");
                }

                lastRead = new Date();
            }
        });
    };

    var sendTweet = function() {

        var textBox = $('.tweet-console input[type="text"]');

        if (textBox.val())
        {
            $.ajax('/tweet', {
                data: {
                    "userName": currentUser,
                    "message": textBox.val()
                },
                type: "POST",
                dataType: "text",
                error: function(jqXhr, status, error) {
                    alert("Unable to send tweet: " + error);
                },
                success: function(data) {
                    if (data === 'ok')
                    {
                        textBox.val('');
                    }
                    else
                    {
                        alert("Unable to send tweet: " + data);
                    }
                }
            });
        }

    };

    $(document).ready(function() {

        $('#tweetButton').on('click', sendTweet);

        getTweets();

        setInterval(function() {
            getTweets();
        }, 5000);
    });

</script>